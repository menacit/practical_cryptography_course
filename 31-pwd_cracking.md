---
SPDX-FileCopyrightText: © 2025 Menacit AB <foss@menacit.se>
SPDX-License-Identifier: CC-BY-SA-4.0

title: "Practical cryptography course: Password cracking"
author: "Joel Rangsmo <joel@menacit.se>"
footer: "© Course authors (CC BY-SA 4.0)"
description: "An introduction to techniques for password cracking"
keywords:
  - "cryptology"
  - "cryptography"
  - "practical"
  - "encryption"
  - "course"
color: "#ffffff"
class:
  - "invert"
style: |
  section.center {
    text-align: center;
  }
  table strong {
    color: #d63030;
  }
  table em {
    color: #2ce172;
  }

---
<!-- _footer: "%ATTRIBUTION_PREFIX% William Warby (CC BY 2.0)" -->
# Password cracking
### Introduction to tools and techniques

![bg right:30%](images/31-door.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% William Warby (CC BY 2.0)" -->
Passwords -
can't live with 'em, can't live without em -
am I right, right?

![bg right:30%](images/31-door.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Cory Doctorow (CC BY-SA 2.0)" -->
**Online VS Offline cracking.**

![bg right:30%](images/31-trunk_skeleton.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Cory Doctorow (CC BY-SA 2.0)" -->
In this course, we'll focus on offline cracking.

![bg right:30%](images/31-trunk_skeleton.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Adam Lusch (CC BY-SA 2.0)" -->
### It's all about the hashes
Passwords are typically stored using
one-way hash functions.  
  
Keys for symmetric encryption are typically generated by a KDF (basically a hash function).  
  
Asymmetric private keys are often stored using symmetric cryptography.

![bg right:30%](images/31-rusty_door_lock.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Adam Lusch (CC BY-SA 2.0)" -->
How do operating systems
store user credentials?

![bg right:30%](images/31-rusty_door_lock.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Adam Lusch (CC BY-SA 2.0)" -->
### Linux / UNIX password storage
Historically, "**/etc/passwd**" used to contain the
(weakly) hashed passwords for users on a system.  
  
These days salted and hashed passwords are
stored in "**/etc/shadow**".

![bg right:30%](images/31-cube_houses.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Adam Lusch (CC BY-SA 2.0)" -->
### $ head -n 2 /etc/shadow
```
root:$6$JMmGEYGBqvCpg.w5$eDg[...]LiUc/:19443:0:::::
bob:$6$t/k/DNYlcQYMgVNJ$PvGi[...]zUA0:19443:0:99999:7:::
```

**What the heck?**

![bg right:30%](images/31-cube_houses.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Adam Lusch (CC BY-SA 2.0)" -->
> Each line of this file contains
> 9 fields, separated by colons (“:”)

— _$ man shadow_

![bg right:30%](images/31-cube_houses.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Adam Lusch (CC BY-SA 2.0)" -->
### Shadow file fields
- Login name
- "Encrypted password"
- Date of last password change
- Minimum password age

[...]

![bg right:30%](images/31-cube_houses.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Adam Lusch (CC BY-SA 2.0)" -->
> Refer to crypt(3) for details on
> how this string is interpreted.

— "Encrypted password field" section

![bg right:30%](images/31-cube_houses.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Adam Lusch (CC BY-SA 2.0)" -->
### "Encrypted" password for root user
```
$6$t/k/DNYlcQYMgVNJ$PvGi[...]zUA0
```

### Sub-fields explained
```
$hash_type$salt$password_hash
```

![bg right:30%](images/31-cube_houses.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Adam Lusch (CC BY-SA 2.0)" -->
## Hash types
- "**1**": MD5
- "**2a**": Blowfish
- "**2y**": Eksblowfish
- "**5**": SHA-256 crypt
- "**6**": SHA-512 crypt
....

![bg right:30%](images/31-cube_houses.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% William Warby (CC BY 2.0)" -->
Many applications store passwords
in similar ways, often in a SQL database.

```
SELECT * FROM user_accounts;

| email           | salt     | hash     |
|-----------------|----------|----------|
| ada@example.com | feab40e1 | fca77c63 |
| bob@example.com | ca1481bb | ca1481bb |
```

![bg right:30%](images/31-door.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Adam Lusch (CC BY-SA 2.0)" -->
## Widows password storage
Credentials for local and "cached" users are
stored in the "SAM database".  
  
Also loves storing credentials for authenticated users in memory.

![bg right:30%](images/31-hudson_yards.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Adam Lusch (CC BY-SA 2.0)" -->
# What the hash?!
### LM or NTLM/NTHash

![bg right:30%](images/31-hudson_yards.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Adam Lusch (CC BY-SA 2.0)" -->
## LM "hash"
Window's legacy method for storing passwords.  
  
Disabled by default in Windows Vista,
but still lingers around in some
enterprise environments.
  
Why replace it, you may ask?

![bg right:30%](images/31-hudson_yards.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Adam Lusch (CC BY-SA 2.0)" -->
## LM "hash"
1. Convert all lower case to upper case
2. "Pad" password to 14 characters with NULL characters, if needed
3. Split the password to two 7 character chunks
4. Create two DES keys from each chunk
5. DES encrypt the string "KGS!@#$%" with each chuck as the key
6. Concatenate the two DES encrypted strings.

![bg right:30%](images/31-hudson_yards.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Adam Lusch (CC BY-SA 2.0)" -->
## NTLM/NTHash
Current method used to store passwords.

The secret sauce?

```
md4(password)
```

Notice anything odd?

![bg right:30%](images/31-hudson_yards.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Adam Lusch (CC BY-SA 2.0)" -->
For all things related to stealing
credentials on a Windows box,
checkout [Mimikatz](https://www.varonis.com/blog/what-is-mimikatz).

![bg right:30%](images/31-hudson_yards.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Stig Nygaard (CC BY 2.0)" -->
**How does "password/hash cracking work?** 
  
1. Calculate hash for password candidate
2. Compare computed hash with stored hash
3. If equal, you've likely found the password, if not repeat with new candidate.

![bg right:30%](images/31-antler.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Stig Nygaard (CC BY 2.0)" -->
## Hash cracking tools
- [**Ophcrack**](https://ophcrack.sourceforge.io/): Live-bootable USB/CD
- [**John The Ripper**](https://www.openwall.com/john/): Swiss army knife, also known as "john"
- [**Hashcat**](https://hashcat.net/): When you wanna crack 'em fast, primarily on GPUs!

![bg right:30%](images/31-antler.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Stig Nygaard (CC BY 2.0)" -->
When you say "fast", what does that mean?  
  
Well, let's run a test with a [RTX 4090](https://www.prisjakt.nu/c/grafikkort?532=39780):

```
$ hashcat --benchmark-all
```

![bg right:30%](images/31-antler.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Stig Nygaard (CC BY 2.0)" -->
## The results

| Hash function | Crack rate |
|---------------|------------|
| SHA512        | 7409 MH/s  |
| SHA1          | 37901 MH/s |
| MD5           | 164 GH/s   |
| NTLM/NTHash   | 288 GH/s   |

<!--
That is 288 billion Windows hashes per second!
-->

![bg right:30%](images/31-antler.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Stig Nygaard (CC BY 2.0)" -->
Let's throw a few of 'em in a server!  
  
What's that - can't afford it?

![bg right:30%](images/31-antler.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Stig Nygaard (CC BY 2.0)" -->
For [~2$/per hour you can get a "g5.12xlarge"](https://aws.amazon.com/ec2/spot/pricing/)
which cracks 368 GH/s of NTLM/NTHash.

![bg right:30%](images/31-antler.jpg)

<!--
Stuffed with x4 Nvidia A10G
-->

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Stig Nygaard (CC BY 2.0)" -->
That's neat, but can we get away cheaper?  

There are some other people who have
showed great interest in abusing GPUs...

![bg right:30%](images/31-antler.jpg)

---
![bg center 70%](images/31-vast_ai_4090_pricing.png)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Stig Nygaard (CC BY 2.0)" -->
(288GH \* 8) \* 3600 ==  
\~8294 TH!  
  
For $2.3, you get
eight quadrillion
two hundred ninety-four trillion
four hundred billion
attempts to break a
Windows password hash.

![bg right:30%](images/31-antler.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Stig Nygaard (CC BY 2.0)" -->
Beware of the risks when cracking
hashes on other peoples' computers.

![bg right:30%](images/31-antler.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Stig Nygaard (CC BY 2.0)" -->
Can we make it go even faster?  
  
FPGAs and ASICs to the rescue!

![bg right:30%](images/31-antler.jpg)

---
![bg center 70%](images/31-antminer_asic.png)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Stig Nygaard (CC BY 2.0)" -->
## Putting things in perspective
Bitcoin uses SHA2-256.  
  
RTX 4090 \* 5 can do \~110 GH/s.  
S21 Hyd. can do **\~355000 GH/s**.  
  
**Brasklapp:** PoW != Password cracking.

![bg right:30%](images/31-antler.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Stig Nygaard (CC BY 2.0)" -->
Our only option isn't just to
throw more compute at the problem.  
  
We can crack smarter.

![bg right:30%](images/31-stevnsfort.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Stig Nygaard (CC BY 2.0)" -->
## Example of permutations
- Prepend/Append years
- Change letter casing
- Prepend/Append "lucky numbers"
- Convert letters to leet-speak 
- Prepend/Append one \+ exclamation mark
- Prepend/Append "keyboard row sequences"
....

![bg right:30%](images/31-stevnsfort.jpg)

---
<!-- _footer: "%ATTRIBUTION_PREFIX% Stig Nygaard (CC BY 2.0)" -->
Curious to learn more and
perfect the art of password cracking?

Check out previous talks
from ["PasswordCon"](https://www.youtube.com/playlist?list=PLdIqs92nsIzQoyLH1cUGCyv_u_RE7v1Jd)!

![bg right:30%](images/31-stevnsfort.jpg)
